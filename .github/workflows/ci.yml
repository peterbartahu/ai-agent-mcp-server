name: CI

on:
  pull_request:
    branches:
      - develop
      - main

jobs:
  branch-policy:
    runs-on: ubuntu-latest
    steps:
      - name: Validate branch name
        run: |
          BRANCH_NAME="${{ github.head_ref }}"
          echo "Checking branch name: $BRANCH_NAME"

          if [[ "$BRANCH_NAME" =~ ^(feature|bugfix|hotfix|subtask)/ ]]; then
            echo "Ticket-based branch detected, validating naming convention..."

            if [[ ! "$BRANCH_NAME" =~ ^(feature|bugfix|hotfix|subtask)/[0-9]+-.*$ ]]; then
              echo "❌ Invalid branch name!"
              echo "Expected format:"
              echo "  feature/000-description"
              echo "  bugfix/000-description"
              echo "  hotfix/000-description"
              echo "  subtask/000-description"
              exit 1
            fi

            echo "✅ Branch name is valid"
          else
            echo "Non ticket-based branch detected, skipping validation"
          fi

  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytest

      - name: Run tests
        run: |
          pytest
